#import "./lib.typ": *
#show: thmrules

#show: probability.with(
  title: "哈尔滨工业大学深圳概率论文",
  your-title: "递推在概率论中的应用",
  date: datetime(year: 2025, month: 12, day: 1), // 修改日期
  name: "xx", // 添加姓名
  student-id: "111111", // 添加学号
  class-id: "计算机与电子通信七班", // 添加班号
  cover-display: true, // 设置为 true 显示封面

  abstract: [
    本文旨在探讨递推思想在概率论与数理统计中的核心应用。递推方法通过全概率公式对随机过程的“第一步”进行条件分析，将复杂的概率问题分解为结构相同的子问题，从而构建出可求解的代数关系，本文讲解了三个经典问题：首先，分析“伯努利装错信封问题” $D_n = (n-1)(D_(n-1) + D_(n-2))$。其次，通过建立期望值的递推关系，分析了“递增游程问题”中抽牌数量的期望及其渐近性质。最后，通过“赌徒破产问题” $P_i = p P_(i+1) + q P_(i-1)$ 的递推关系，推导了赌徒获胜概率的通项公式，计算出公平与不公平赌局下的不同结果，同时展示了马尔可夫链的应用。
    #v(16pt)
  ],
  keywords: ("概率论", "递推关系", "错排问题", "赌徒破产", "递增游程"),
)

= 递推在概率论中的应用

== 概率论中的序列问题与递推思想

概率论与数理统计中的许多核心问题，与序列性或时间或试验次数有关。这些问题考察的对象往往随时间或试验次数或某些因素变化，例如：一个系统在第 $n$ 步的状态、在 $n$ 次试验中等待某个模式的出现 。

递推关系是描述序列最强有力的数学工具之一，它通过序列的前 $k$ 项来定义第 $n$ 项。这种思想在计算机科学的算法分析中被广泛用于分析时间复杂度（例如斐波那契数列或归并排序 ）。然而，在概率论中，递推扮演着更为深刻的建模角色，通过对某个事件列出递推公式，我们可以将问题转化为数列求解问题，利用不动点，线性递推等方法求出通项公式。

== 递推方法的核心思想

我们可以通过全概率公式去推算出第 $n$ 步与前面 $n-1$ 步的关系，从而建立递推关系。这种方法的核心在于将复杂的问题分解为更简单的子问题，通过递推公式逐步求解。 递推方法的关键步骤包括：

1. 找出所求事件概率与某个参数的关系 （例如，试验次数 $n$、赌徒的资本 $i$）的概率 $P_n$ 或期望 $E_n$。
2. 我们利用全概率公式，将问题在 $n$ 状态下的求解 。
3. 以概率为例， $P_n = sum_j P(P_n | "第一步结果为" j) dot P( "第一步结果为" j )$。
4. 该方法的关键在于，在给定第一步的结果 $j$ 之后，剩余的问题 $P(P_n | "第一步结果为" j )$ 通常可以被简化为 同一类型（例如 $n-1$ 或 $n-2$）的子问题 。
5. 通过这种方式，我们建立了一个关于 $P_n$, $P_(n-1)$ 和 $P_(n-2)$ 的代数方程——即递推关系。
6. 最后根据递推公式求解通项公式。

#pagebreak()

= 递推方法的应用

== 伯努利装错信封问题

“装错信封问题”是组合概率论中最经典的问题之一。

问题描述如下：将 $n$ 封写给 $n$ 个不同收信人的信，随机放入 $n$ 个对应的信封（每个信封对应一个收信人）。我们关心的是“完全错配”的排列数量，即 没有 一封信被放入正确信封的排列数，记为 $D_n$ 。我们的最终目标是求解在 $n!$ 种总排列中，发生完全错配的概率 $P_n = D_n / n!$ 。

=== 递推关系的建立

$D_n = (n-1)(D_(n-1) + D_(n-2))$

我们用有多少封信要装作为下标，考虑“第 1 封信”的放在哪里。总共有 $n!$ 种排列。

步骤一：考虑第 1 封信（记为信 1）。要构成一个错排，信 1 不能 放入第 1 个信封（记为信封 1）。因此，信 1 有 $(n-1)$ 种选择。我们假设信 1 被放入了第 $k$ 个信封

步骤二：在信 1 放入信封 $k$ 的前提下，我们对放在哪里进行分类讨论 
- 信 $k$ 放入了信封 1
  - 信 1 在信封 $k$ 中，信 $k$ 在信封 1 中
  - 问题被简化为：我们只需确保剩下的 $(n-2)$ 封信（即除了 1 和 $k$ 之外的所有信）也必须全部装错（即信 $i$ 不放入信封 $i$， $i != 1 且 i != k$）
  - 满足这种情况的方法数，根据定义，等于 $(n-2)$ 个元素的错排数，即 $D_(n-2)$
- 信 $k$ 没有放入信封
  - 此时，信 1 在信封 $k$ 中。对于剩下的 $(n-1)$ 封信，我们必须将它们放入剩下的 $(n-1)$ 个信封中
  - 这等价于一个 新 的 $(n-1)$ 元素的错排问题：我们有 $(n-1)$ 个元素和 $(n-1)$ 个“目标位置”。在这个新问题中，信 $k$ 的“正确”位置被指定为信封 1，而其他信的正确位置保持不变，满足这种情况的方法数为 $D_(n-1)$ 。
  
步骤三： 得到最终的递推关系：
$D_n = (n-1)(D_(n-1) + D_(n-2))$

初始条件为：
$D_1 = 0, D_2 = 1$

步骤四：利用递推关系求解通项公式

根据以上的递推关系，我们可以得出通项公式是：
$D_n = n! sum_(i=0)^(n) (-1)^i/i!$

#pagebreak()

=== 极限分析

当 $n -> oo$ 时，$P_n$ 的表达式 $sum_(k=0)^n (-1)^k / k!$ 正是指数函数 $e^x$ 在 $x=-1$ 处的泰勒级数展开式。因此，我们有：
$lim_(n->oo) P_n = lim_(n->oo) D_n / n!  = 1/e$
所以，随着信封数量的增加，完全错配的概率趋近于 $1/e$，这是一个很优美的结果。

=== 装错信封问题总结

通过对装错信封问题的递推分析，我们不仅得到了错排数的递推关系，还推导出了其通项公式$D_n = n! sum_(i=0)^(n)(-1)^i/(i!)$。这一结果体现了递推方法在解决组合概率问题中的作用。

== 递增游程问题 

本题目灵感来自于《The first course in probability》 @ross2014first 的游程问题。问题描述如下：一个牌堆中有 $1 ~ n$ 号牌，抽到每一种序号的概率是相等的。现在开始抽牌，要求抽出来的牌序号必须严格递增。一旦抽到的牌序号小于或等于上一张牌的序号，则停止抽牌，并将当前这张牌也算入拿走的牌中。例如：若抽取顺序是 "1, 2, 3, 4, 1"，由于最后一张 $1 < 4$，停止抽牌，共拿走 5 张牌。求拿走牌的数量的期望。

我们定义 $E_n$ 为从 $n$ 张牌中抽取时，拿走牌的数量的期望，显然 $E_0 = 1$ 。我们的目标是求解 $E_n$ 。

=== 递推关系的建立

步骤一 ：定义随机变量 $L$ 为拿走牌的数量。我们引入指示变量 $I_k$ 表示第 $k$ 张牌是否被拿走：
$ I_k = cases(1\, & "如果第" k "张牌被拿走", 0\, & "如果第" k "张牌没被拿走") $
显然，总共拿走的牌数 $L = sum_(k=1)^n I_k$。根据期望的线性性质：
$ E[n] = E[sum_(k=1)^n I_k] = sum_(k=1)^(n-1) E[I_k] + E[I_n] $
其中前 $n-1$ 项的和正是 $n-1$ 张牌时的期望 $E[n-1]$。而 $E[I_n] = P(I_n=1)$，即第 $n$ 张牌被拿走的概率。
因此可得递推关系：$E[n] = E[n-1] + P(L >= n)$。
事件 $L >= n$ 意味着前 $n$ 张牌必须是严格递增的。

步骤二 ：计算 $P(L >= n)$

对于任意 $n$ 张牌，它们严格递增排列的概率是 $1/n!$。
因此，$P(L >= n) = 1 / n!$ 。

步骤三： 建立递推关系

得到最终的递推关系：
$E_n = E_(n-1) + 1/n!$

步骤四 ： 求出通项公式

利用累加法，我们可以直接得出通项公式为：
$E_n = sum_(i=0)^(n) 1/i!$

=== 极限分析
当 $n -> +oo$ 时，级数 $sum_(i=0)^(n) 1/i!$ 正是 $e^x$ 在 $x=1$ 处的泰勒展开。因此：
$lim_(n->oo) E_n = e$

这表明，当牌的数量非常大时，拿走牌的数量的期望趋近于 $e$。

=== 递增游程问题总结

通过对递增游程问题的递推分析，我们建立了期望 $E_n$ 的递推关系 $E_n = E_(n-1) + 1/n!$，并推导出了通项公式 $E_n = sum_(i=0)^(n) 1/i!$。这一结果不仅揭示了递推方法在解决期望计算中的应用，还展示了当牌的数量趋近于无穷大时，期望值趋近于数学常数 $e$ 的优美性质。

== 赌徒破产问题

考虑一个赌徒，其初始资本为 $i$ 元。在每轮独立的赌局中，他以概率 $p$ 赢 1 元，以概率 $q=1-p$ 输 1 元。赌局在以下两种情况之一发生时结束：
1. 总资本达到 0 元。
2. 总资本达到 $N$ 元。

我们定义 $P_i$ 为赌徒从 $i$ 元资本开始，在破产之前 成功达到目标 $N$ 的概率

我们要求解 $P_i$ (对于 $0 < i < N$)。这个问题的解完全由递推关系和结束条件确定 ：

- 结束条件1: $P_0 = 0$。如果赌徒从 0 元开始，他已经破产，因此他达到 $N$ 的概率为 0。
- 结束条件1: $P_N = 1$。如果赌徒从 $N$ 元开始，他已经达到了目标，因此概率为 1 。

=== 递推关系的建立

步骤一 ：设 $A$ 为赌徒最终达到 $N$ 的事件。$P_i = P(A | "初始资本" i)$
$P_i = P(A | "第一局赢") dot P("第一局赢") + P(A | "第一局输") dot P("第一局输")$ 。

步骤二 ： $P("第一局赢") = p$ 且 $P("第一局输") = q$，我们有：
- $P(A | "第一局赢")$：如果第一局赢了，赌徒的资本变为 $i+1$。赌局是独立的，赌徒从 $i+1$ 元出发并最终达到 $N$ 的概率，根据 $P_i$ 的定义，就是 $P_(i+1)$
- $P(A | "第一局输")$：如果第一局输了，赌徒的资本变为 $i-1$。同理，他最终达到 $N$ 的概率是 $P_(i-1)$。
  
步骤三 ：得到递推关系：
$P_n = p P_(n+1) + q P_(n-1)$

步骤四 ：求解递推关系的特征根，设为 $r_1$ 和 $r_2$，得到通解为：
$P_n = A r_1^n + B r_2^n$
其中 $A$ 和 $B$ 由边界条件确定。（线性递推方程求解方法参考附录2）

== 结果分析

=== 公平赌局

如果输赢概率均为 $p = q = 0.5$，则通项公式简化为：
$P_i = i / N$

解释：在公平赌局中，赌徒获胜的概率等于其初始资本占总资本的比例。这是一个非常优美的结果。

=== 不公平赌局

此时， $x_1=1, x_2=q/p != 1$，特征根是不同的

通项公式为：
$P_i = ( (q/p)^i - 1 ) / ( (q/p)^N - 1 )$
解释：在不公平赌局中，赌徒获胜的概率取决于输赢概率的比值 $q/p$ 以及初始资本 $i$ 和目标资本 $N$ 。

== 赌徒破产问题总结

赌徒破产问题不仅体现了递推方法在概率论中的应用，还展示了线性递推方程的求解技巧，证明当一个问题与步数或时间有关时，递推关系是分析其概率性质的有力工具。

#pagebreak()

#appendix(
  "问题总结表格",
)[
  #figure(
    table(
      columns: (auto, auto, auto, auto, auto),
      align: (left, left, left, left, left),
      stroke: 0.5pt,
      inset: 8pt,
      
      // 表头
      [*经典问题*],
      [*变量定义*],
      [*递推关系*],
      [*边界/初始条件*],
      [*求解/极限*],
      
      // 装错信封问题
      [装错信封问题],
      [$D_n$: $n$ 个元素的错排数],
      [$D_n = (n-1)(D_(n-1) + D_(n-2))$],
      [$D_1 = 0, \ D_2 = 1$],
      [$P_n = D_n/n! -> 1/e$],
      
      // 递增游程问题
      [递增游程问题],
      [$E_n$: 从 $n$ 张牌中\n抽取牌数的期望],
      [$E_n = E_(n-1) + 1/n!$],
      [$E_0 = 1$],
      [$E_n = sum_(i=0)^n 1/i! -> e$],
      
      // 赌徒破产问题（公平）
      table.cell(
        rowspan: 2,
        [赌徒破产问题]
      ),
      table.cell(
        rowspan: 2,
        [$P_i$: 从 $i$ 元达到 $N$ 元的概率]
      ),
      table.cell(
        rowspan: 2,
        [$P_i = p P_(i+1) + q P_(i-1)$]
      ),
      table.cell(
        rowspan: 2,
        [$P_0 = 0,\  P_N = 1$]
      ),
      [$p = 1/2$: $P_i = i/N$],
      
      // 赌徒破产问题（不公平）
      [$p != 1/2$: \ $P_i = ((q/p)^i - 1)/((q/p)^N - 1)$],
    ),
    caption: [三个经典递推问题的总结对比]
  )
]

#appendix(
  "线性递推方程的求解方法",
)[
  == 线性递推方程简介

  附录中对线性方程的介绍参考了 数学奥林匹克小丛书 @mathematical_induction_sequences 中的的内容。

  线性递推方程（Linear Recurrence Relation）是形如：
  $ a_n = c_1 a_(n-1) + c_2 a_(n-2) + dots.c + c_k a_(n-k) $
  的方程，其中 $c_1, c_2, dots, c_k$ 为常数系数。

  === 步骤二：求解特征根

  通过求解特征方程：
  $ r^k - c_1 r^(k-1) - c_2 r^(k-2) - dots - c_k = 0 $
  $#text("解出特征根")r_1, r_2, dots, r_k$。
  === 步骤三：构建通解
  根据特征根的不同情况，构建通解：
  - 若特征根互不相同，则通解为：
    $ a_n = A_1 r_1^n + A_2 r_2^n + dots + A_m r_m^n $
  - 若存在重根，则通解中需乘以 $n$ 的幂次。
  === 步骤四：确定常数
  利用初始条件，将初始条件代入通项公式，求解通解中的常数 $A_1, A_2, dots, A_m$。
]

#bib(bibliography("refs.bib"))
